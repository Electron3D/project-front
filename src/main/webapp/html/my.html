<html>
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link rel="stylesheet" type="text/css" href="/css/my.css">
</head>
<body>
<h1>RPG admin panel</h1>
<h3>Accounts list:</h3>
<p>Count per page:
<select id="elementsOnPage">
    <option value="3">3</option>
    <option value="8">8</option>
    <option value="15">15</option>
    <option value="20">20</option>
</select>
</p>
<table id="myTable"></table>
<div id="pagesSelector">
Pages: <div id="buttonsBlock"></div>
</div>

<script>
    let pageSize = $('#elementsOnPage').val();
    let numberOfPages = 1;
    let pageNumber = 0;
    createPagesSelector();
    drawTable();
    $('#elementsOnPage').change(function () {
        $('#buttonsBlock').empty();
        $('#myTable').empty();
        pageSize = $('#elementsOnPage').val();
        pageNumber = 0;
        drawTable();
        createPagesSelector()
    });

    function drawHeader() {
        $('#myTable').append('<tr>' +
            '<td>#</td>' +
            '<td>Name</td>' +
            '<td>Title</td>' +
            '<td>Race</td>' +
            '<td>Profession</td>' +
            '<td>Level</td>' +
            '<td>Birthday</td>' +
            '<td>Banned</td>' +
        '</tr>')
    }
    function drawTable() {
        $.get( "/rest/players", {pageNumber, pageSize}, function( data ) {
            drawHeader();
            $.each(data, function (index, value){
                let date = new Date(value.birthday);
                let day = date.getDate();
                let month = date.getMonth() + 1;
                let year = date.getFullYear();
                let formattedDate = month + '/' + day + '/' + year;
                let number = index + 1;
                if (pageNumber > 0) {
                    number = pageNumber * pageSize + index + 1;
                }
                $('#myTable').append('<tr>' +
                    '<td>'+ number + '</td>' +
                    '<td>' + value.name + '</td>' +
                    '<td>' + value.title + '</td>' +
                    '<td>' + value.race + '</td>' +
                    '<td>' + value.profession + '</td>' +
                    '<td>' + value.level + '</td>' +
                    '<td>' + formattedDate + '</td>' +
                    '<td>' + value.banned + '</td>' +
                    '</tr>');
            });
        });
    }
    function createPagesSelector() {
        $.get( "/rest/players/count", function (data) {
            numberOfPages = data / pageSize;
            for (let i = 0; i < numberOfPages; i++) {
                let currentPageNumber = i + 1;
                $('#buttonsBlock').append('<button value="' + i + '" onclick="changePage(this)">' + currentPageNumber + '</button>');
            }
        });
    }
    function changePage(button) {
        pageNumber = button.value;
        $('#myTable').empty();
        drawTable();
    }
</script>
</body>
</html>