<html>
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link rel="stylesheet" type="text/css" href="/css/my.css">
</head>
<body>
<h1>RPG admin panel</h1>
<h3>Accounts list:</h3>
<p>Count per page:
<select id="elementsOnPage">
    <option value="3">3</option>
    <option value="6">6</option>
    <option value="10">10</option>
    <option value="15">15</option>
    <option value="20">20</option>
</select>
</p>
<table id="myTable"></table>
<div id="pagesSelector">
Pages: <div id="buttonsBlock"></div>
</div>

<script>
    let pageSize = $('#elementsOnPage').val();
    let numberOfPages = 0;
    let pageNumber = 0;
    createPagesSelector();
    $('#elementsOnPage').change(function () {
        pageSize = $('#elementsOnPage').val();
        createPagesSelector()
    });

    function drawHeader() {
        $('#myTable').append('<tr id="header">' +
            '<td>#</td>' +
            '<td>Name</td>' +
            '<td>Title</td>' +
            '<td>Race</td>' +
            '<td>Profession</td>' +
            '<td>Level</td>' +
            '<td>Birthday</td>' +
            '<td>Banned</td>' +
            '<td>Edit</td>' +
            '<td>Delete</td>' +
        '</tr>');
        $('#header')
            .css({'background-color' : '#ffacac'})
    }
    function drawTable() {
        drawHeader();
        $.get( "/rest/players", {pageNumber, pageSize}, function( data ) {
            $.each(data, function (index, value){
                let date = new Date(value.birthday);
                let day = date.getDate();
                let month = date.getMonth() + 1;
                let year = date.getFullYear();
                let formattedDate = month + '/' + day + '/' + year;
                let number = value.id;
                $('#myTable').append('<tr id="tablebody">' +
                    '<td>'+ number + '</td>' +
                    '<td>' + value.name + '</td>' +
                    '<td>' + value.title + '</td>' +
                    '<td>' + value.race + '</td>' +
                    '<td>' + value.profession + '</td>' +
                    '<td>' + value.level + '</td>' +
                    '<td>' + formattedDate + '</td>' +
                    '<td>' + value.banned + '</td>' +
                    '<td><button value="' + number + '"onclick="editRow(this)"><img src="/img/edit.png" id="Edit button"></button></td>' +
                    '<td><button value="' + number + '"onclick="deleteRow(this)"><img src="/img/delete.png" id="Delete button"></button></td>' +
                    '</tr>');
            });
        });
    }
    function createPagesSelector() {
        $('#buttonsBlock').empty();
        $.get( "/rest/players/count", function (data) {
            numberOfPages = data / pageSize;
            if (numberOfPages === 0) {
                numberOfPages++;
            }
            for (let i = 0; i < numberOfPages; i++) {
                let currentPageNumber = i + 1;
                $('#buttonsBlock').append('<button id="' + i + 'PageButton" value="' +
                    i + '" onclick="changePage(this)">' + currentPageNumber + '</button>');
            }
            if (pageNumber >= numberOfPages) {
                pageNumber--;
            }
            let pageSelector = '#' + pageNumber + 'PageButton';
            changePage(pageSelector);
        });
    }
    function changePage(pageSelector) {
        let $buttons = $(pageSelector);
        let button = $buttons[0];
        pageNumber = button.value;
        $('#buttonsBlock').children().css({'color' : '#000001'}).css({'font-weight' : '400'});
        $(button).css({'color' : '#ff2323'}).css({'font-weight' : '700'});
        $('#myTable').empty();
        drawTable();
    }
    function editRow(button) {

    }
    function deleteRow(button) {
        let id = button.value;
        $.ajax({
            url: '/rest/players/' + id,
            type: 'DELETE'
        }).done(function () {
            createPagesSelector();
        })
    }
</script>
</body>
</html>